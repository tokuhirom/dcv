# Homebrew Release Setup Guide

This document explains how to set up the Homebrew release process for DCV.

## Prerequisites

1. A GitHub repository named `homebrew-tap` under your account
2. A Fine-grained Personal Access Token for GitHub

## Step 1: Create the Homebrew Tap Repository

1. Go to GitHub and create a new repository named `homebrew-tap`
2. Initialize it with a README file
3. The repository URL should be: `https://github.com/tokuhirom/homebrew-tap`

## Step 2: Create a Fine-grained Personal Access Token

1. Go to GitHub Settings → Developer settings → Personal access tokens → Fine-grained tokens
2. Click "Generate new token"
3. Set the following:
   - **Token name**: `homebrew-tap-token` (or any name you prefer)
   - **Expiration**: Choose an appropriate expiration date
   - **Repository access**: Select "Selected repositories" and choose `tokuhirom/homebrew-tap`
   - **Permissions**:
     - Contents: Read and Write
     - Metadata: Read

4. Click "Generate token" and copy the token

## Step 3: Add the Token as a Repository Secret

1. Go to the DCV repository settings
2. Navigate to Secrets and variables → Actions
3. Click "New repository secret"
4. Add the secret:
   - **Name**: `TAP_GITHUB_TOKEN`
   - **Value**: Paste the token you created in Step 2

## Step 4: Create a Release

Once everything is set up, creating a release is simple:

```bash
# Make sure you're on the main branch with all changes committed
git checkout main
git pull

# Create and push a tag
git tag v0.1.0
git push origin v0.1.0
```

GitHub Actions will automatically:
1. Run tests
2. Build binaries for multiple platforms
3. Create a GitHub release
4. Update the Homebrew formula in your tap repository

## Step 5: Verify the Release

After the release workflow completes:

1. Check the [Releases page](https://github.com/tokuhirom/dcv/releases) for the new release
2. Check the [homebrew-tap repository](https://github.com/tokuhirom/homebrew-tap) for the updated formula
3. Test the Homebrew installation:

```bash
brew tap tokuhirom/tap
brew install dcv
dcv --version
```

## Troubleshooting

### Release workflow fails with permission error

- Ensure the `TAP_GITHUB_TOKEN` has write access to the Contents of the homebrew-tap repository
- Verify the token hasn't expired

### Homebrew formula not updated

- Check the GoReleaser logs in the GitHub Actions workflow
- Ensure the homebrew-tap repository exists and is accessible

### Installation via Homebrew fails

- Try updating the tap: `brew update`
- Check if the formula exists: `brew search tokuhirom/tap/dcv`

## Notes

- The Homebrew formula is automatically generated by GoReleaser
- Don't manually edit the formula in the homebrew-tap repository
- Version tags should follow semantic versioning (e.g., v0.1.0, v1.0.0)